{"version":3,"names":["asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","cloneDeep","require","path","fs","babel","registerCache","nmRE","escapeRegExp","sep","string","replace","cache","transformOpts","exports","setOptions","opts","clear","load","get","extensions","Object","assign","caller","name","cwd","ignore","undefined","only","cwdRE","RegExp","transform","input","filename","loadOptionsAsync","sourceRoot","dirname","cached","store","cacheLookup","code","map","transformAsync","sourceMaps","ast","transformSync","OptionManager","init","id","cacheKey","JSON","stringify","version","env","getEnv","fileMtime","statSync","mtime","setDirty"],"sources":["../../src/worker/transform.js"],"sourcesContent":["\"use strict\";\n\nconst cloneDeep = require(\"clone-deep\");\nconst path = require(\"path\");\nconst fs = require(\"fs\");\n\nconst babel = require(\"./babel-core.js\");\nconst registerCache = require(\"../cache.js\");\n\nconst nmRE = escapeRegExp(path.sep + \"node_modules\" + path.sep);\n\nfunction escapeRegExp(string) {\n  return string.replace(/[|\\\\{}()[\\]^$+*?.]/g, \"\\\\$&\");\n}\n\nlet cache;\nlet transformOpts;\nexports.setOptions = function (opts) {\n  if (opts.cache === false && cache) {\n    registerCache.clear();\n    cache = null;\n  } else if (opts.cache !== false && !cache) {\n    registerCache.load();\n    cache = registerCache.get();\n  }\n\n  delete opts.cache;\n  delete opts.extensions;\n\n  transformOpts = {\n    ...opts,\n    caller: {\n      name: \"@babel/register\",\n      ...(opts.caller || {}),\n    },\n  };\n\n  let { cwd = \".\" } = transformOpts;\n\n  // Ensure that the working directory is resolved up front so that\n  // things don't break if it changes later.\n  cwd = transformOpts.cwd = path.resolve(cwd);\n\n  if (transformOpts.ignore === undefined && transformOpts.only === undefined) {\n    const cwdRE = escapeRegExp(cwd);\n\n    // Only compile things inside the current working directory.\n    transformOpts.only = [new RegExp(\"^\" + cwdRE, \"i\")];\n    // Ignore any node_modules inside the current working directory.\n    transformOpts.ignore = [\n      new RegExp(`^${cwdRE}(?:${path.sep}.*)?${nmRE}`, \"i\"),\n    ];\n  }\n};\n\nexports.transform = async function (input, filename) {\n  const opts = await babel.loadOptionsAsync({\n    // sourceRoot can be overwritten\n    sourceRoot: path.dirname(filename) + path.sep,\n    ...cloneDeep(transformOpts),\n    filename,\n  });\n\n  // Bail out ASAP if the file has been ignored.\n  if (opts === null) return null;\n\n  const { cached, store } = cacheLookup(opts, filename);\n  if (cached) return cached;\n\n  const { code, map } = await babel.transformAsync(input, {\n    ...opts,\n    sourceMaps: opts.sourceMaps === undefined ? \"both\" : opts.sourceMaps,\n    ast: false,\n  });\n\n  return store({ code, map });\n};\n\nif (!process.env.BABEL_8_BREAKING) {\n  exports.transformSync = function (input, filename) {\n    const opts = new babel.OptionManager().init({\n      // sourceRoot can be overwritten\n      sourceRoot: path.dirname(filename) + path.sep,\n      ...cloneDeep(transformOpts),\n      filename,\n    });\n\n    // Bail out ASAP if the file has been ignored.\n    if (opts === null) return null;\n\n    const { cached, store } = cacheLookup(opts, filename);\n    if (cached) return cached;\n\n    const { code, map } = babel.transformSync(input, {\n      ...opts,\n      sourceMaps: opts.sourceMaps === undefined ? \"both\" : opts.sourceMaps,\n      ast: false,\n    });\n\n    return store({ code, map });\n  };\n}\n\nconst id = value => value;\n\nfunction cacheLookup(opts, filename) {\n  if (!cache) return { cached: null, store: id };\n\n  let cacheKey = `${JSON.stringify(opts)}:${babel.version}`;\n\n  const env = babel.getEnv();\n  if (env) cacheKey += `:${env}`;\n\n  const cached = cache[cacheKey];\n  const fileMtime = +fs.statSync(filename).mtime;\n\n  if (cached && cached.mtime === fileMtime) {\n    return { cached: cached.value, store: id };\n  }\n\n  return {\n    cached: null,\n    store(value) {\n      cache[cacheKey] = { value, mtime: fileMtime };\n      registerCache.setDirty();\n      return value;\n    },\n  };\n}\n"],"mappings":"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","ignoreList":[]}