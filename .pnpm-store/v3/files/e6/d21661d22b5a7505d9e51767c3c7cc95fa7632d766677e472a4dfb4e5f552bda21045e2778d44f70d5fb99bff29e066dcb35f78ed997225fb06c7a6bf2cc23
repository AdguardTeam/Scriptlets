{"version":3,"file":"rollup-plugin-cleanup.js","sources":["../src/create-filter.js","../src/parse-options.js","../src/index.js"],"sourcesContent":["\nimport { createFilter } from 'rollup-pluginutils'\n\nconst justExt = (file) => {\n  const match = /[^/\\\\]\\.([^./\\\\]*)$/.exec(file)\n  return match ? match[1] : ''\n}\n\n/**\n * Creates a filter for the options `include`, `exclude`, and `extensions`.\n * Since `extensions` is not a rollup option, I think is widely used.\n *\n * @param {object} opts? - The user options\n * @returns {function}     Filter function that returns true if a given\n *                         file matches the filter.\n */\nconst _createFilter = function (opts) {\n\n  const filter = createFilter(opts.include, opts.exclude)\n\n  let exts = opts.extensions || ['js', 'jsx', 'mjs']\n  if (!Array.isArray(exts)) {\n    exts = [exts]\n  }\n\n  for (let i = 0; i < exts.length; i++) {\n    const e = exts[i]\n    if (e === '*') {\n      return filter\n    }\n    if (e[0] === '.') {\n      exts[i] = e.substr(1)\n    }\n  }\n\n  return (name) => (filter(name) && exts.indexOf(justExt(name)) > -1)\n}\n\nexport default _createFilter\n","import cleanup from 'js-cleanup'\n\n// Support for deprecated filters\nconst translateFilter = function (item, ix, arr) {\n  switch (item) {\n    case 'srcmaps':\n      arr[ix] = 'sources'\n      break\n    // istanbul ignore next\n    case 'jscs':\n      arr[ix] = /^[/*]\\s*jscs:[ed]/\n      break\n  }\n}\n\n// multiple forms to specify comment filters, default is 'some'\nconst getFilters = (filters) => {\n\n  if (typeof filters === 'boolean') {\n    return filters === true ? 'all' : 'none'\n  }\n\n  if (filters) {\n    filters = Array.isArray(filters) ? filters : [filters]\n    filters.forEach(translateFilter)\n    // throws on unknown filters\n    cleanup('', null, { comments: filters, sourcemap: false })\n  }\n\n  return filters || 'some'\n}\n\nconst parseOptions = (options) => {\n  const comments = getFilters(options.comments)\n\n  return {\n    comments,\n    compactComments: options.compactComments !== false,\n    lineEndings: options.lineEndings || options.normalizeEols,\n    maxEmptyLines: options.maxEmptyLines | 0,\n    sourcemap: options.sourceMap !== false && options.sourcemap !== false,\n  }\n}\n\nexport default parseOptions\n","import cleanup from 'js-cleanup'\nimport createFilter from './create-filter'\nimport parseOptions from './parse-options'\n\n/**\n * Returns the rollup-plugin-cleanup instance.\n * @param   {Object} options - Plugin's user options\n * @returns {Object} Plugin instance.\n */\nconst rollupCleanup = function (options) {\n  options = options || {}\n\n  // merge include, exclude, and extensions\n  const filter = createFilter(options)\n\n  // validate and clone the plugin options\n  options = parseOptions(options)\n\n  // the plugin instance\n  return {\n\n    name: 'cleanup',\n\n    transform(code, id) {\n\n      if (filter(id)) {\n        return new Promise((resolve) => {\n          try {\n            resolve(cleanup(code, id, options))\n          } catch (err) {\n            // istanbul ignore else\n            if ('position' in err && this.error) {\n              this.error(err.message, err.position)\n            } else {\n              throw err\n            }\n          }\n        })\n      }\n\n      return null\n    },\n  }\n}\n\nexport default rollupCleanup\n"],"names":["createFilter"],"mappings":"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"}